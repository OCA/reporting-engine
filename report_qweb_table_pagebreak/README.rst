============================
Report QWeb table page break
============================

.. 
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! source digest: sha256:89ca3c64fb73035aa3485e0e2e4a067820ea055a3344f8d0258197745570c9a4
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

.. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
    :target: https://odoo-community.org/page/development-status
    :alt: Beta
.. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
    :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
    :alt: License: AGPL-3
.. |badge3| image:: https://img.shields.io/badge/github-OCA%2Freporting--engine-lightgray.png?logo=github
    :target: https://github.com/OCA/reporting-engine/tree/14.0/report_qweb_table_pagebreak
    :alt: OCA/reporting-engine
.. |badge4| image:: https://img.shields.io/badge/weblate-Translate%20me-F47D42.png
    :target: https://translation.odoo-community.org/projects/reporting-engine-14-0/reporting-engine-14-0-report_qweb_table_pagebreak
    :alt: Translate me on Weblate
.. |badge5| image:: https://img.shields.io/badge/runboat-Try%20me-875A7B.png
    :target: https://runboat.odoo-community.org/builds?repo=OCA/reporting-engine&target_branch=14.0
    :alt: Try me on Runboat

|badge1| |badge2| |badge3| |badge4| |badge5|

Control Page Breaks in `<table>`'s within QWeb Reports

The primary objective of this module is to prevent tables
from being split arbitrarily and to provide better control
over page breaks within tables.

This technical module provides developers with a method
to manage page breaks at the table row (`<tr>`) level.

Since `<tr>` elements are not block elements, direct
application of page break properties (`page-break-before`/
`page-break-after` / `page-break-inside`) is not possible.
Instead, this module handles the division of tables and
manages page breaks at the table (`<table>`) level.

**Motivations for Modifying HTML from Python Code:**

Developers may question why HTML is changed from Python code
rather than overloading the report template using QWeb.
Here are the reasons:

1. **Duplicating Table Headers:** Managing report modularity becomes
   challenging when other modules add new columns to tables. This
   solution offers an easy way to maintain overloaded reports
   manipulated by different modules.

2. **Ease of Template Code Writing:** This approach simplifies
   template code by allowing the management of attributes at
   the row level.

.. note::

   Splitting tables happens on QWeb templates so if you share
   templates between your PDF Qweb reports and portails views, it will
   happens on both.

**Table of contents**

.. contents::
   :local:

Usage
=====

This module manipulates HTML tables in the result HTML report (just before
transforming the result to PDF by wkhtmltopdf).

It searches for any ``qweb-table-page-break`` attribute on ``<tr>`` elements.

If the value of the ``qweb-table-page-break`` attribute is one of the following
strings, the current table will be split (copying the header of the current
table) and apply the proper break page on ``<table>``'s elements:

- **before**: force breaking page before the row
- **after**: force breaking page after the row
- **avoid**: split the table and avoid breaking page inside the table as much
  as possible.

For instance, if you choose to create a new table on each new section in a sale
order line, you could overwrite the template like this::

    <template
        id="report_saleorder_document"
        inherit_id="sale.report_saleorder_document"
    >
        <xpath
            expr="//tbody[hasclass('sale_tbody')]/t/tr"
            position="attributes"
        >
            <attribute name="t-attf-qweb-table-page-break">
                {{line.display_type == 'line_section' and 'avoid' or ''}}
            </attribute>
        </xpath>
    </template>

This would create a new table for each section and add
``page-break-inside=avoid;`` style on each table. For example, in the following
example, we can see on the left, without this module Odoo splits section
before subtotal, while on the right, headers are repeated on each section, and
sections are entirely displayed on the same page:

|before_after| **Before**: Without this module on the left -- **After**: Using
this module adding ``qweb-table-page-break="avoid"`` on each section row
on the right

.. warning::

    All this magic will generate multiples ``<table>`` elements from one ``<table>``
    element in your final html document which could impact your css rules.

.. |before_after| image:: https://raw.githubusercontent.com/OCA/reporting-engine/14.0/report_qweb_table_pagebreak/static/src/img/before-after.png
   :width: 200px

Known issues / Roadmap
======================

* Support table `<caption>`, `<colgroup>` and `<tfoot>` elements
* Consider to not split table if `qweb-table-page-break` is equals
  to one of those values: `before` or `avoid` and is the first row
* Consider to not split table if `qweb-table-page-break` is equals
  to `after` and it is the last row of the table

Bug Tracker
===========

Bugs are tracked on `GitHub Issues <https://github.com/OCA/reporting-engine/issues>`_.
In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us to smash it by providing a detailed and welcomed
`feedback <https://github.com/OCA/reporting-engine/issues/new?body=module:%20report_qweb_table_pagebreak%0Aversion:%2014.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.

Do not contact contributors directly about support or help with technical issues.

Credits
=======

Authors
~~~~~~~

* Pierre Verkest

Contributors
~~~~~~~~~~~~

* Pierre Verkest <pierreverkest84@gmail.com>

Maintainers
~~~~~~~~~~~

This module is maintained by the OCA.

.. image:: https://odoo-community.org/logo.png
   :alt: Odoo Community Association
   :target: https://odoo-community.org

OCA, or the Odoo Community Association, is a nonprofit organization whose
mission is to support the collaborative development of Odoo features and
promote its widespread use.

.. |maintainer-petrus-v| image:: https://github.com/petrus-v.png?size=40px
    :target: https://github.com/petrus-v
    :alt: petrus-v

Current `maintainer <https://odoo-community.org/page/maintainer-role>`__:

|maintainer-petrus-v| 

This module is part of the `OCA/reporting-engine <https://github.com/OCA/reporting-engine/tree/14.0/report_qweb_table_pagebreak>`_ project on GitHub.

You are welcome to contribute. To learn how please visit https://odoo-community.org/page/Contribute.
